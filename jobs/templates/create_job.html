{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card shadow-sm border-0">
            <div class="card-body p-4">
                <h3>Post a Job</h3>
                <p class="text-muted">Fill out the form to create a job posting.</p>

                <form id="jobForm" class="mt-3">
                    {% csrf_token %}
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Job Title</label>
                            <input id="title" class="form-control" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Company Name</label>
                            <input id="company_name" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Job Role</label>
                            <input id="job_role" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Experience (years)</label>
                            <select id="experience" class="form-select">
                                <option>0-1 years</option>
                                <option>1-3 years</option>
                                <option>3-5 years</option>
                                <option>5-8 years</option>
                                <option>8+ years</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">CTC</label>
                            <input id="ctc" class="form-control" placeholder="e.g. 6 LPA">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Location</label>
                            <input id="location" class="form-control" required>
                        </div>

                        <div class="col-12">
                            <label class="form-label">Description</label>
                            <textarea id="description" class="form-control" rows="5" required></textarea>
                        </div>

                        <div class="col-12 text-end">
                            <button type="submit" class="btn btn-success">Create Job</button>
                        </div>
                    </div>
                </form>

            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('jobForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const data = {
        title: document.getElementById('title').value,
        company_name: document.getElementById('company_name').value,
        job_role: document.getElementById('job_role').value,
        experience: document.getElementById('experience').value,
        ctc: document.getElementById('ctc').value,
        location: document.getElementById('location').value,
        description: document.getElementById('description').value
    };

    const res = await fetch('/api/jobs/', {
        method: 'POST',
        credentials: 'same-origin',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify(data)
    });

    if (res.status === 201) {
        // redirect to job list (will show user's jobs)
        window.location.href = "{% url 'job_list' %}";
    } else if (res.status === 403) {
        alert('You must be logged in to create a job.');
        window.location.href = "{% url 'login' %}";
    } else {
        const json = await res.json();
        alert('Could not create job: ' + JSON.stringify(json));
    }
});
</script>

{% endblock %}
